<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="js/vue.global.js"></script>
  <title>Document</title>
  <style>
    .board {
      display: flex;
      width: 95vw;
      max-width: 900px;
      max-height: 900px;
      height: 95vw;
      margin: 10px;
      background: green;
      
      flex-direction: row;
      flex-wrap: wrap;

     /* justify-content: space-between;*/
    }
    .row{
      display: flex;
      flex-direction: row;
      width:100%;
      height:12.5%;
      background-color: red;
    }
    
    .cell{
      background-color:#EDD4AF;
      margin:0px;
      padding:0px;
      width:12.5%;
      height:100%;
      display: block;
      margin: auto;
      vertical-align: middle;
      }
    .cell.dark {
      background-color: #AA7D5C;
    }
    .cell.bright {
      background-color: #EDD4AF;
    }
    .cell.selected{
      background-color: green;
    }
    img{
      width:100%; 
      height:100%;

    }
  </style>
</head>
<body>
  <div id="chessboard">
    <div class="board">
      
      <div class="row" v-for="row in board">
        <div class="cell"  v-for="cell in row" :class="cell.shade" v-on:click="boardClick(cell)" :x="cell.x" :y="cell.y">
         
          <img :src="pieceMap[cell.piece].file" ></img>
        </div>
      </div>
    </div>
    
      <p>{{ message }}</p>
      <input v-model="message" />
  </div>
</body>
</html>


<script>



const ChessBoard = {
  data() {
    return {
      pieceMap:{
        0 : {["piece"]:"","file":"img/empty.png"},
        1 : {["piece"]:"whitePawn","file":"img/pawnWhite.svg","color":"white"}
      },
      selectedCell:undefined,
      message: 'Hello Vue!',
      /*
      * board: board[][]
      * shade: bright,dark or selected
      * x
      * y
      * piece: int
      */
      board: []
    }
  },
  mounted(){
    this.createBaord()
    this.setStartPieces()
   
  },
  methods: {
    createBaord:function(){
      for(var x=0;x<8;x++){
        this.board[x]=[]
        var shade = "bright"
        if(x%2===1){
          shade="dark"
        }
        for(var y=0;y<8;y++){
          this.board[x][y]={}
          this.board[x][y]["piece"]=0
          this.board[x][y]["shade"]=shade
          this.board[x][y]["x"]=x
          this.board[x][y]["y"]=y
          if(shade==="dark"){
            shade="bright"
          }else{
            shade="dark"
          }
        }
      } 
    },
    setStartPieces:function(){
      for(var i =0;i<8;i++){
        this.board[6][i]["piece"]=1;
      }
    },
    boardClick: function (ncell) {

      //Don'T eat your own pieces,
      //select them instead
      if(this.selectedCell!==undefined&&
        this.pieceMap[ncell.piece].color===this.pieceMap[this.selectedCell.piece].color){
        this.restoreCellColor(this.selectedCell)
        ncell.shade="selected"
        this.selectedCell=ncell
        return
      }
      // if you click on the same piece twice
      // you deselect them
      if(this.selectedCell===ncell){
        this.restoreCellColor(this.selectedCell)
        this.selectedCell=undefined
        return
      }

      // you cannot select empty fields
      //
      if(this.selectedCell===undefined&&
         ncell.piece!==0){ 
        ncell.shade="selected"
        this.selectedCell=ncell
        return;
      }
      // if there is one selected field
      // move it to the new field
       if(this.selectedCell!==undefined){
        this.restoreCellColor(this.selectedCell)
        ncell.piece=this.selectedCell.piece;
        this.selectedCell.piece=0
        this.selectedCell=ncell
        this.selectedCell=undefined
      } 

        this.message=ncell.x+" "+ncell.y
        
     
      
    },
    restoreCellColor: function(cell){
      if(this.selectedCell!==undefined){
          
          if(this.selectedCell.y%2===0){
            if(this.selectedCell.x%2===0){
              this.selectedCell.shade="bright";
            }else{
              this.selectedCell.shade="dark";
            }
          }
          if(this.selectedCell.y%2===1){
            if(this.selectedCell.x%2===1){
              this.selectedCell.shade="bright";
            }else{
              this.selectedCell.shade="dark";
            }
          }
        }
    }
  }
}

Vue.createApp(ChessBoard).mount('#chessboard')
</script>